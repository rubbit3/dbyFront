


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple HTML with JavaScript</title>
	<script src="./fft.js"></script>
	
	 <style>
        canvas {
            border: 1px solid black;
        }
    </style>
	
	
</head>
<body>
    <h1>Simple HTML with JavaScript</h1>
	 <h1>Frequency Spectrum</h1>
  <canvas id="spectrumCanvas" width="800" height="400"></canvas>
	
    <button onclick="cc()">Click me!</button>

    <script>
       

function cc(){
	
	
	
	 let fftData = [];//输出
	 //let mdata = [];//输入
	 let data_length = 1050;//输入的数据长度
	 let size = 1024; //计算块的长度
	 let acc = 6;
	 const mdata = [
      -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981,
	  -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, -0.005069, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981,
      -0.005069, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981, -0.000981,
      -0.000981, 0.003106, 0.003106, -0.000981, 0.003106, 0.003106, 0.003106, 0.003106,
      0.003106, -0.000981, -0.000981, 0.003106, -0.000981, -0.000981, -0.000981, 0.003106,
      0.003106, 0.003106, -0.000981, -0.000981, -0.000981, -0.000981, 0.003106, 0.003106,
      -0.000981, -0.000981
    ];
	
	
	
            if(data_length >= size)
            {
                let times = parseInt(data_length / size);

                for(let i = 0;i < times;i++) {
                    let fft = new FFT(size);
                    let input = new Array(size);

                    for(let j = 0 ;j < size;j++)
                    {
                        let p = i*size + j;
                        input[j] = parseFloat(mdata[p]);
                    }

                    let out = fft.createComplexArray();
                    let data = fft.toComplexArray(input);
                    fft.transform(out, data);

                    if(i === 0) {
                        let outsize = out.length / 2;
                        for (let i = 0; i < outsize; i = i + 2) {
                            let b = Math.sqrt(Math.pow(out[i], 2) + Math.pow(out[i + 1], 2));
                            fftData.push(b);
                        }
                    }else{
                        let outsize = out.length / 2;
                        let k = 0;
                        for (let i = 0; i < outsize; i = i + 2) {
                            let b = Math.sqrt(Math.pow(out[i], 2) + Math.pow(out[i + 1], 2));

                            fftData[k] = fftData[k] + b;
                            k++;
                        }
                    }
                }

                for(let i = 0;i < fftData.length;i++)
                {
                    fftData[i] = (fftData[i] / times / fftData.length).toFixed(acc);
                }

                fftData[0] = fftData[3];
                fftData[1] = fftData[3];
                fftData[2] = fftData[3];
            }
			
			
			console.log(fftData);
		 drawFrequencySpectrum(fftData);
			
}
 function drawFrequencySpectrum(data) {
            const canvas = document.getElementById('spectrumCanvas');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const len = 512; // 分成512份
            const maxFreq = 25; // 最大频率
            const freqStep = maxFreq / len;

            // 清除画布
            ctx.clearRect(0, 0, width, height);

            // 绘制背景框
            ctx.strokeRect(0, 0, width, height);

            // 绘制频谱
            ctx.beginPath();
            ctx.moveTo(0, height);

            for (let i = 0; i < len; i++) {
                const x = (i * width) / len;
                const y = height - (data[i] * height) / Math.max(...data); // 归一化纵坐标
                ctx.lineTo(x, y);
            }
            ctx.lineTo(width, height);
            ctx.closePath();
            ctx.fillStyle = 'rgba(0, 0, 255, 0.5)'; // 填充颜色
            ctx.fill();
            ctx.stroke();
        }
		
    </script>
</body>
</html>


